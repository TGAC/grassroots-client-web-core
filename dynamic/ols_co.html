<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Grassroots Infrastructure</title>


    <link rel="stylesheet" href="../dynamic/styles/style.css" type="text/css"/>
    <!-- font awesome -->
    <link href="../dynamic/scripts/fontawesome-free-5.9.0-web/css/all.css" rel="stylesheet" type="text/css"/>

    <!-- jQuery -->
    <script type="text/javascript" src="../dynamic/scripts/jquery/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/jquery/jquery-ui-1.11.4.custom/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="../dynamic/scripts/jquery/jquery-ui-1.11.4.custom/jquery-ui.min.css"
          type="text/css"/>
    <link rel="stylesheet" href="../dynamic/scripts/jquery/colorbox/colorbox.css"
          type="text/css"/>

    <!-- datatables -->
    <script type="text/javascript" src="../dynamic/scripts/jquery/datatables/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/jquery/datatables/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/jquery/jszip.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/jquery/Buttons-1.5.6/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/jquery/Select-1.3.0/js/dataTables.select.min.js"></script>

    <link rel="stylesheet" href="../dynamic/scripts/jquery/datatables/css/jquery.dataTables.min.css"
          type="text/css"/>
    <link rel="stylesheet" href="../dynamic/scripts/jquery/Buttons-1.5.6/css/buttons.bootstrap.min.css"
          type="text/css"/>
    <link rel="stylesheet" href="../dynamic/scripts/jquery/Select-1.3.0/css/select.bootstrap.min.css"
          type="text/css"/>


    <!-- bootstrap -->
    <script src="../dynamic/scripts/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../dynamic/scripts/bootstrap/js/validator.js" type="text/javascript"></script>
    <!--<link href="../dynamic/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>-->

    <!-- wis -->
    <script type="text/javascript" src="config.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/gi_dynamic_web.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/fieldtrial_map.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/wis.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/FileSaver.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/gis_map.js"></script>

    <!-- sheetjs js-xlsx -->
    <script type="text/javascript" src="../dynamic/scripts/js-xlsx/xlsx.full.min.js"></script>

    <!-- csv to json -->
    <script type="text/javascript" src="../dynamic/scripts/csvjson.min.js"></script>


    <script src="../dynamic/scripts/d3/d3.min.js" type="text/javascript"></script>
    <!-- Leaflet -->
    <link rel="stylesheet" href="../dynamic/scripts/leaflet/leaflet.css"/>
    <script src="../dynamic/scripts/leaflet/leaflet.js"></script>

    <!-- Leaflet markercluster -->
    <link rel="stylesheet" href="../dynamic/scripts/leaflet.markercluster/MarkerCluster.css"/>
    <link rel="stylesheet" href="../dynamic/scripts/leaflet.markercluster/MarkerCluster.Default.css"/>
    <script src="../dynamic/scripts/leaflet.markercluster/leaflet.markercluster.js"></script>
    <!-- polymarker -->
    <script type="text/javascript" src="../dynamic/scripts/marker.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/biojs_io_fasta.min.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/msa.min.gz.js"></script>
    <script type="text/javascript" src="../dynamic/scripts/jquery/js/jquery.csvToTable.js"></script>
    <link rel="stylesheet" href="../dynamic/scripts/jquery/css/csvtable.css" type="text/css"/>
    <link rel="stylesheet" href="../dynamic/styles/msa.min.gz.css" type="text/css"/>


    <!-- new style bit -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet"
          type="text/css">

    <link href="https://grassroots.tools/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="https://grassroots.tools/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">-->
    <!--<script src="https://grassroots.tools/vendor/bootstrap/js/bootstrap.min.js"></script>-->

    <!--<script src="https://grassroots.tools/vendor/popper/popper.min.js"></script>-->
    <!--<script src="https://grassroots.tools/js/site.js"></script>-->

    <!--<script src="https://grassroots.tools/vendor/jquery-easing/jquery.easing.min.js"></script>-->
    <link href="https://grassroots.tools/css/site.css" rel="stylesheet">


</head>
<body></body>
<script type="text/javascript">
    $(document).ready(function () {
        $(this).scrollTop(0);
        if (getUrlParameter('search') != null) {
            var searchString = getUrlParameter('service');
            search_co(searchString);
        }
        // var pathname = (window.location.pathname).split('/');
        // var lastSegment = pathname.pop() || pathname.pop();
        // if (lastSegment != 'services.html' && lastSegment != 'service' && lastSegment != '' && lastSegment != null) {
        //     populateService(lastSegment.replace(/%20/g, " "));
        // }
        // $(window).keydown(function (event) {
        //     if (event.keyCode == 13) {
        //         event.preventDefault();
        //         return false;
        //     }
        // });
    });


    var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    };

    function search_co(str) {
        var input = $('#ft_ajax_search').val();

        var input_tail = "";

        if (isOdd((input.match(/\"/g) || []).length)) {
            input_tail = "\"";
        }
        if (((input.match(/\"/g) || []).length) == 0) {
            input_tail = "*";
        }

        console.log(input_tail);

        if (input.length > 1) {

            $('#ajax_result').html('Searching <img src=\"/dynamic/images/ajax-loader.gif\"/>');
            var timer;

            var submit_json = {
                "services": [
                    {
                        "start_service": true,
                        "so:name": "Search Field Trials",
                        "parameter_set": {
                            "level": "simple",
                            "parameters": [

                                {
                                    "param": "FT Keyword Search",
                                    "current_value": input + input_tail
                                },
                                {
                                    "param": "FT Facet",
                                    "current_value": "Measured Variable"
                                },
                                {
                                    "param": "FT Results Page Number",
                                    "current_value": 0
                                },
                                {
                                    "param": "FT Results Page Size",
                                    "current_value": 500
                                }
                            ]
                        }
                    }
                ]
            };
            console.log(submit_json);

            clearTimeout(timer);

            timer = setTimeout(function () {
                $.ajax({
                    url: server_url,
                    data: JSON.stringify(submit_json),
                    type: "POST",
                    dataType: "json",
                    success: function (json) {
                        var result_array = json['results'][0]['results'];
                        if (result_array == undefined) {
                            $('#ajax_result').html("No result found");
                        } else {
                            $('#ajax_result').html(format_treatment_ajax_result(result_array));
                            var datatable = $('#treatment_result').DataTable({
                                "searching": false,
                                "aaSorting": [],
                                dom: 'lBfrtip',
                                buttons: [
                                    {
                                        extend: 'copyHtml5',
                                        title: null,
                                        messageTop: null,
                                        messageBottom: null,
                                        header: false,
                                        exportOptions: {
                                            columns: [8]
                                        }
                                    },
                                    {
                                        extend: 'csvHtml5',
                                        title: null,
                                        messageTop: null,
                                        messageBottom: null,
                                        header: false,
                                        exportOptions: {
                                            columns: [8]
                                        }
                                    },
                                    {
                                        extend: 'excelHtml5',
                                        title: null,
                                        messageTop: null,
                                        messageBottom: null,
                                        header: false,
                                        exportOptions: {
                                            columns: [8]
                                        }
                                    }
                                ],
                                select: true
                            });
                            simpleOrAdvanced('show_simple');
                            //
                            // $('#treatment_result tbody').on('click', 'tr', function () {
                            //     var data = datatable.row(this).data();
                            //     copyToClipboard(data[8]);
                            //     $('#message').show();
                            //     $('#message').animate({opacity: 1.0}, 500).fadeOut();
                            //     console.log(data);
                            // });

                        }
                    }
                });
            }, 0);
        } else {
            $('#ajax_result').html('Enter a longer search query.');
        }

    }
</script>


</html>
